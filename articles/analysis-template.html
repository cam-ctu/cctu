<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysis Template • cctu</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis Template">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cctu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.8.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analysis-template.html">Analysis Template</a></li>
    <li><a class="dropdown-item" href="../articles/using-cttab.html">Use cttab in the Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/rmarkdown_report.html">Generate HTML Report</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cam-ctu/cctu/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analysis Template</h1>
                        <h4 data-toc-skip class="author">Simon Bond</h4>
            
            <h4 data-toc-skip class="date">2026-01-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cam-ctu/cctu/blob/master/vignettes/analysis-template.Rmd" class="external-link"><code>vignettes/analysis-template.Rmd</code></a></small>
      <div class="d-none name"><code>analysis-template.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-this-document-does">What this Document Does<a class="anchor" aria-label="anchor" href="#what-this-document-does"></a>
</h2>
<p>The package <code>cctu</code> is designed to help run the analysis of
clinical trials which typically produce an output of a large word
document with one page per table or figure following on from a
Statistical Analysis Plan, and requires substantial audit trails.
Automating the trivialities of getting tables into word from R, and
capturing the meta data and audit trials is what the package
achieves.</p>
<p>This document should give you an overview of the tools provided in
this package, explain the thought behind them, and show how to use them
together. We will start by explaining the rationale, and then finish
with a worked example. A complimentary set of R scripts and outputs,
that aren’t easily directly captured within a vignette are also provided
with the /doc directory.</p>
<p>Further functions and tools have been added, for more streamlined
importing of MACRO data, give improvements to the basic tables, and to
automate the reporting of missing data. These are explained more in the
separate <code>using-cttab</code> vignette.</p>
</div>
<div class="section level2">
<h2 id="key-concepts">Key Concepts<a class="anchor" aria-label="anchor" href="#key-concepts"></a>
</h2>
<div class="section level3">
<h3 id="meta-table">Meta Table<a class="anchor" aria-label="anchor" href="#meta-table"></a>
</h3>
<p>As part of writing the Statistical Analysis Plan (SAP), a structured
meta-table with one row per table or figure needs to be produced. This
provides titles, subtitles, numbering, populations, etc. See the help
page <code>meta_table</code> for more details. The package is very
reliant on this being provided by the user. Whilst producing the
tables/figures the package will:</p>
<ul>
<li>look up which population is to be used for a table/figure and
explicitly filter the data sets to the desired population</li>
<li>whilst saving the output it will use the numbering to determine file
names of xml or graphics files</li>
<li>write the name of the code file that produced the output</li>
</ul>
<p>When producing the final output it will use the meta-table to index
all the outputs, and pull out the meta-data needed.</p>
<p>Given all the interactions needed, which is somewhat contrary to the
concept in R of functions just returning output rather than modifying
the user environment, the meta_table is stored within a environment that
is private to the package. So it needs to be set up using
<code><a href="../reference/get_meta_table.html">set_meta_table()</a></code> and <code><a href="../reference/get_meta_table.html">get_meta_table()</a></code> to
extract a copy.</p>
</div>
<div class="section level3">
<h3 id="populations">Populations<a class="anchor" aria-label="anchor" href="#populations"></a>
</h3>
<p>It is assumed that there is a data.frame that has one row per
subject, and a column for each population defined in the SAP that is a
logical indicating if a subject is included in each population. The
definition of the populations, their names, and how the inclusion is to
determined, are all important steps but outside of this package!</p>
<p>We provide a function <code>create_popn_envir</code> that takes the
data.frame described above, and a list of other data.frames. It then
filters each of the listed data.frame, looping over each of the
populations, and saves them within a set of environments one per
population.</p>
<p>During the analysis code, the function <code><a href="../reference/attach_pop.html">attach_pop()</a></code> is
repeatedly called with the number of a table/figure. The corresponding
row from meta-table is used to identify which population is associated
with the table/figure, and the environment is attached. So the list of
dataframes that were filtered in <code>create_popn_envir</code> can now
be accessed, safe in the knowledge that the right population is
used.</p>
</div>
<div class="section level3">
<h3 id="code-architecture">Code Architecture<a class="anchor" aria-label="anchor" href="#code-architecture"></a>
</h3>
<p>A set of default local files can be set up using
<code>cctu_initialise</code> where the outputs will be stored using the
default arguments.</p>
<p>The code itself is assumed to be modularised into a sequence of code
that calls other code using <code>source</code>. Copies of the scripts
used in this vignette are available within the package folder
<code>/scripts</code>.</p>
<ul>
<li>
<code>Main.R</code> at the top with a minimal amount of
initialisation: working directory, PATHs, <code><a href="https://cam-ctu.github.io/cctu/">library(cctu)</a></code>,
<code><a href="../reference/run_batch.html">run_batch()</a></code>, then a sequence of <code><a href="../reference/source.html">source()</a></code>,
final calling of <code><a href="../reference/create_word_xml.html">create_word_xml()</a></code> and maybe further calls
to <code>render</code> for other outputs.</li>
<li>A configuration file, loading packages, setting graphical defaults,
loading bespoke functions,</li>
<li>Data import and manipulation: where cleaning, merging, creating
derived variables maybe, and finally using
<code>create_popn_envir</code> happens.</li>
<li>Analysis: where the actual statistical work happens. May well be
modularised further with individual scripts for each section of the
study, ordered by Form or chronological ordering of the study.</li>
</ul>
<p>It is important to call <code><a href="https://cam-ctu.github.io/cctu/">library(cctu)</a></code> before the first
use of <code>source</code>. The package modifies the base function
<code><a href="https://rdrr.io/r/base/source.html" class="external-link">base::source</a></code>, so as to record the name of the file that
called source and the name of the file sourced. This is to provide an
audit trail allowing the sequence of code used to create a table/figure
to be easily found. Like <code>meta_table</code> this audit trail lives
in a private environment and is not easily directly accessible.</p>
</div>
<div class="section level3">
<h3 id="xml">XML<a class="anchor" aria-label="anchor" href="#xml"></a>
</h3>
<p>The step of transferring table and figures to word is facilitated by
xml. The tables are stored as a copy on a local drive (in /Output/Core
by default) in semi-readable format with tags similar to html
tables.</p>
<p>During the analysis, a block of code to produce a table or figure is
put between an <code><a href="../reference/attach_pop.html">attach_pop()</a></code> and a
<code><a href="../reference/write_table.html">write_table()</a></code> or <code>write_gglot()</code>. An argument to
<code>write_table</code> will be a data frame; <code>write_ggplot</code>
defaults to using the last plot object, or can take a ggplot object as
an argument. A recent addition is <code>write_plot</code> which can
handle ggplot object or other graphical outputs e.g. a dot_plot from the
<code>eudract</code> package.</p>
<p>All <code>write_*</code> functions then look up the number of the
table called by <code>attach_pop</code> (temporarily stored in a private
environment); the output is stored on the local drive either an XML
file, or graphics file named with a suffix “_X.Y.Z” to identify the
output; the name of the code file that created the output is written to
meta-table; by default a final call to <code>clean_up</code> removes all
objects in the global environment (apart from those named in the vector
<code>.reserved</code>) and detach the population environment.</p>
<p>After the analysis, the function <code>write_docx</code> glues these
files all together along with the meta data into a large xml file. The
tables are directly copied, and the figures have links to their file
paths. Then xslt technology is used to convert the document into the <a href="http://schemas.microsoft.com/office/word/2003/wordml" class="external-link">schema</a>
used by MS Word, so it can be opened directly.</p>
<p>Previously the command <code>create_word_xml</code> was used, which
then needed subsequent steps to convert to a fully compliant docx with
figures. Included for back compatibility now.</p>
<p>If you want to tweak the style of the word document then you would
edit the <a href="../extdata/xml_to_word.xslt">xslt file</a> totally at
your own risk! This is not the case with <code>write_docx</code>
anymore. You are not allowed to edit this file as the Docx file is
complicated.</p>
</div>
<div class="section level3">
<h3 id="pointers">Pointers<a class="anchor" aria-label="anchor" href="#pointers"></a>
</h3>
<p>Other function may be worth looking up in their help files, and
hopefully their names give a hint!</p>
<div class="section level4">
<h4 id="data-import-manipulation">Data import &amp; Manipulation<a class="anchor" aria-label="anchor" href="#data-import-manipulation"></a>
</h4>
<ul>
<li><code>read_data</code></li>
<li><code>data_table_summary</code></li>
<li><code>clean_names</code></li>
<li><code>remove_blank_rows_cols</code></li>
<li>Recent additions are:
<ul>
<li><code>var_lab</code></li>
<li><code>apply_macro_dict</code></li>
<li><code>extract_form</code></li>
</ul>
</li>
</ul>
<p>The set of external data files to be read in, along with the names of
the corresponding data.frames created should be recorded in one initial
data.frame. This can then be summarised in a table in the report using
<code>data_table_summary</code> and also used to succinctly read in all
the data files with <code>read_data</code>.</p>
</div>
<div class="section level4">
<h4 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h4>
<ul>
<li>
<code><a href="../reference/sumby.html">sumby()</a></code> is a work-horse to produce standard summary
tables, with additional figures produced as side-effects</li>
<li>
<code>cttab</code> is a recent addition which greatly expands the
flexibility and scope from <code>sumby</code>
</li>
<li>
<code>regression_table</code> is a function that takes a regression
object (lm, glm, lme, gee, coxph, gls) and produces a summary table
suitable for a report, allowing you to provide a character vector to
label the parameters meaningfully.</li>
<li>
<code>km_ggplot</code> is a function that takes a
<code>survfit</code> object and produces a publication-quality fig of
the Kaplan-Meier plot with error-bands plus a table counting numbers at
risk and with events.</li>
<li><code>propercase</code></li>
<li>
<code>rbind_space</code> : to glue together repeated outputs from
<code>sumby</code>
</li>
<li>
<code>clean_up</code> is called by default within each call of
<code>write_*</code>. They have arguments to not call
<code>clean_up</code> if the code is such that you need to re-use the
same R objects for multiple outputs.</li>
<li>
<code>.reserved</code> is a hidden variable in the global
environment. <code>clean_up</code> ignores any objects named in
<code>.reserved</code>. So you can edit this as an alternative to using
the arguments within <code>write_*</code>, but ideally it should be
defined once at the end of data manipulation.</li>
<li>
<code>rm_envir</code> maybe helpful during code development and
interactive use of <code>attach_pop</code>.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="missing-data">Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h3>
<p>With the use of <code>cttab</code> there are created as a side-effect
summaries of missing data. See these functions</p>
<ul>
<li><code>dump_missing_report</code></li>
<li><code>get_missing_report</code></li>
<li><code>reset_missing_report</code></li>
</ul>
</div>
<div class="section level3">
<h3 id="audit-trails">Audit trails<a class="anchor" aria-label="anchor" href="#audit-trails"></a>
</h3>
<p>As described already <code><a href="../reference/source.html">source()</a></code> captures a trail of which
code sources other code. There is a demonstration below of how to
convert this into a graphical tree representation using a combination of
Rmarkdown and latex. Or you can just get a copy
<code>cctu:::cctu_env$code_tree</code> and write a local copy to a csv
file say.</p>
<p>In a similar fashion we have some examples of Rmarkdown that can be
use to read in the outputs from <code>write_*</code> and produce a Html
or pdf, or … version of the main report, depending on what the readers
of the report prefer as their format.</p>
<p>At the end of your code it is good practice to run
<code>Sys.info(), date(), sessionInfo()</code> to document the fine
details of your session, package versions, etc. Also it may want to be
run for the final definitive version of the report on a different server
with a validated instance of R, using a <code>R CMD Batch</code> which
has the nice side-effect of creating a .Rout file with a complete log of
all the code and outputs. A wrapper function to avoid having to open a
command line window for your operating system is
<code><a href="../reference/run_batch.html">run_batch()</a></code> .</p>
</div>
</div>
<div class="section level2">
<h2 id="worked-example">Worked Example<a class="anchor" aria-label="anchor" href="#worked-example"></a>
</h2>
<p>This document is used to illustrate how to set up a standard set of
analysis using the library cctu. It assumes that you have copied across
a template blank folder structure (<code>cctu_initialise</code>),
created a library within the main folder with all the extra packages you
may need, and set up a git versioning instance and rstudio project. A
future project will be to document this step.</p>
<p>In the the top level this is a file called “main.R”</p>
<div class="section level3">
<h3 id="initial-lines">Initial lines<a class="anchor" aria-label="anchor" href="#initial-lines"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># if using renv for extra packages need this line for R CMD BATCH</span></span>
<span><span class="co"># renv::load()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cam-ctu.github.io/cctu/">cctu</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'cctu'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     source</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># run_batch("main.R")</span></span>
<span><span class="va">DATA</span> <span class="op">&lt;-</span> <span class="st">"PATH_TO_DATA"</span></span>
<span><span class="fu"><a href="../reference/cctu_initialise.html">cctu_initialise</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cctu_initialise.html">rm_output</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you run just these initial lines, the last command will evoke R
CMD BATCH to run the entire set of code and produce a log file
“main.Rout”, which should be the final step, using the validated server.
The <code>run_batch</code> line is commented out as the vignette will
not work with this though..</p>
<p>This vignette now differs from a standard use, in that the
<code>Main.R</code> file would now be a sequence of
<code><a href="../reference/source.html">source()</a></code> calls. Here we do run the source files, and then
quote the R code they contain. There is a copy of all files and outputs
from a standard use starting from <a href="Main.R">Main.R</a></p>
</div>
<div class="section level3">
<h3 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h3>
<p>It is recommended to set up a config.R file that</p>
<ul>
<li>reads in all your libraries</li>
<li>sets up graphical settings</li>
<li>maybe reads in some bespoke functions you want to define</li>
</ul>
<div class="section level4">
<h4 id="library-management">Library management<a class="anchor" aria-label="anchor" href="#library-management"></a>
</h4>
<p>If you use the Docker image <code>shug0131/cctu</code> then it should
be a rare event that you need to install any extra packages. But if you
do then it preferable to manage this using <code>renv</code> package.
Best practice is to write a list of the packages needed, including any
extra ones, in a DESCRIPTION file at the top level, listing them under
the <code>Imports:</code> heading. Running
<code>cctu::initialise()</code> will by default create this DESCRITPTION
file and remind you to edit it.</p>
<p>Then you modify the script in <code>config.R</code> to read this file
and workout which packages to load. The function
<code><a href="../reference/library_description.html">library_description()</a></code> will do this step for you.</p>
<p>If you do need to use <code>renv</code> for installing extra
packages, then adding them to DESCRIPTION will make this all very
explicit, and will help create the <code>renv.lock</code> file correctly
to get the package versions of everything that you need.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="../reference/source.html">source</a></span><span class="op">(</span><span class="st">"Progs/config.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/library_description.html">library_description</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># mylibs &lt;- c("readxl", "dplyr", "ggplot2", "magrittr","tidyr","rmarkdown","knitr","xml2","rvest")</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># for(package in mylibs){</span></span>
<span><span class="co">#   library(package, character.only = TRUE)</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span></span>
<span><span class="co"># read in all function files</span></span>
<span><span class="va">my_functions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"Progs\\functions"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">my_functions</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span> <span class="va">file</span> <span class="op">!=</span> <span class="st">"archive"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="../reference/source.html">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Progs\\functions\\"</span>, <span class="va">file</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define theme for figures</span></span>
<span><span class="va">default_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_get</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graphical_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>  axis.line.x      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>  axis.line.y      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>  panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span> ,</span>
<span>  panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="co"># panel.border = element_blank(),</span></span>
<span>  <span class="co"># axis.text = element_text(size = rel(1), angle = 45)</span></span>
<span>  axis.title.x     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  legend.key       <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove anything no longer required</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">mylibs</span>, <span class="va">package</span>, <span class="va">my_functions</span>, <span class="va">file</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="data-import">Data Import<a class="anchor" aria-label="anchor" href="#data-import"></a>
</h3>
<p>Next step is to import the meta-table, study data and apply
manipulations, and finally create the population environments.</p>
<ul>
<li>Grab data from the “DATA” folder. Always use relative paths, or
build absolute paths up from MACRO variables defined once near the start
‘paste0(DATA, “/myfile.csv”)’</li>
<li>convert the variable names into standard ‘lower_case’ so you have to
remember less</li>
<li>remove blank rows and columns</li>
<li>give factor variables their levels</li>
<li>make dates into dates if needed, whilst being careful of partial
dates…</li>
</ul>
<p>Here we grab a ready prepared ‘dirty’ raw data typical of MACRO DB
and apply some of these concepts.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="../reference/source.html">source</a></span><span class="op">(</span><span class="st">"Progs/data_import.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>,<span class="st">"codes"</span><span class="op">)</span>,</span>
<span>  file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dirtydata.csv"</span>,</span>
<span>         <span class="st">"codes.csv"</span><span class="op">)</span>,</span>
<span>  folder<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package<span class="op">=</span><span class="st">"cctu"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span><span class="va">data_table</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span> <span class="va">data_table</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># take an template meta table and add a new row with edited values.</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu">cctu</span><span class="fu">::</span><span class="va"><a href="../reference/meta_table_example.html">meta_table_example</a></span></span>
<span><span class="va">regress</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">regress</span><span class="op">$</span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"Regression: Age predicted by Treatment"</span></span>
<span><span class="va">regress</span><span class="op">$</span><span class="va">number</span> <span class="op">&lt;-</span> <span class="st">"1.2"</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">regress</span><span class="op">)</span></span>
<span></span>
<span><span class="va">km</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">km</span><span class="op">$</span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"Kaplan-Meier Plot"</span></span>
<span><span class="va">km</span><span class="op">$</span><span class="va">number</span> <span class="op">&lt;-</span> <span class="st">"1.3"</span></span>
<span><span class="va">km</span><span class="op">$</span><span class="va">item</span> <span class="op">&lt;-</span> <span class="st">"figure"</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">km</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_meta_table.html">set_meta_table</a></span><span class="op">(</span> <span class="va">meta</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/write_table.html">write_table</a></span><span class="op">(</span><span class="fu"><a href="../reference/data_table_summary.html">data_table_summary</a></span><span class="op">(</span><span class="va">data_table</span><span class="op">)</span>,number <span class="op">=</span> <span class="st">"9"</span>, clean_up <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Not strictly needed as the default is to apply these two functions inside of read_data(), but this</span></span>
<span><span class="co"># can be turned off with clean_names_option = FALSE , or remove_blank_rows_cols_option=FALSE</span></span>
<span><span class="va">data</span> <span class="op">%&lt;&gt;%</span> <span class="fu"><a href="../reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/remove_blank_rows_cols.html">remove_blank_rows_cols</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">codes</span> <span class="op">%&lt;&gt;%</span> <span class="va">clean_names</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">x</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">codes</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">code_df</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">codes</span>, <span class="va">var</span><span class="op">==</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">code_df</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">data</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span>, levels<span class="op">=</span><span class="va">code_df</span><span class="op">$</span><span class="va">code</span>, labels<span class="op">=</span><span class="va">code_df</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span> <span class="va">data</span><span class="op">$</span><span class="va">start_date</span> , format<span class="op">=</span><span class="st">"%d/%m/%Y"</span><span class="op">)</span></span>
<span><span class="va">data_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="st">"subject_id"</span>, <span class="va">data_name</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"subjid"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#Create the population table</span></span>
<span></span>
<span><span class="va">popn</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>,<span class="st">"subjid"</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">popn</span><span class="op">$</span><span class="va">safety</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">popn</span><span class="op">$</span><span class="va">full</span> <span class="op">&lt;-</span> <span class="va">popn</span><span class="op">$</span><span class="va">subjid</span><span class="op">&lt;</span><span class="fl">5</span></span>
<span></span>
<span><span class="fu"><a href="../reference/create_popn_envir.html">create_popn_envir</a></span><span class="op">(</span><span class="st">"data"</span>,<span class="va">popn</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#tidy up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">code_df</span>, <span class="va">codes</span>, <span class="va">data_name</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">.reserved</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>From here one could refer to the vignette <code>using-cttab</code>,
and apply further functions: <code>apply_macro_dict</code>, and/or
<code>var_lab</code></p>
</div>
<div class="section level3">
<h3 id="analysis-1">Analysis<a class="anchor" aria-label="anchor" href="#analysis-1"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="../reference/source.html">source</a></span><span class="op">(</span><span class="st">"Progs/analysis.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/attach_pop.html">attach_pop</a></span><span class="op">(</span><span class="st">"1.1"</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rbind_space.html">rbind_space</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/sumby.html">sumby</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">treatment</span> , data<span class="op">=</span><span class="va">data</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/sumby.html">sumby</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">treatment</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_table.html">write_table</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/attach_pop.html">attach_pop</a></span><span class="op">(</span><span class="st">"1.1.1"</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rbind_space.html">rbind_space</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/sumby.html">sumby</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">treatment</span>, data<span class="op">=</span><span class="va">data</span>, label<span class="op">=</span><span class="st">"aGe (yAars)"</span>, text_clean <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/sumby.html">sumby</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">treatment</span>, data<span class="op">=</span><span class="va">data</span>, text_clean <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_table.html">write_table</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/attach_pop.html">attach_pop</a></span><span class="op">(</span><span class="st">"1.10"</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sumby.html">sumby</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">treatment</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_ggplot.html">write_ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">X</span>,<span class="st">"fig"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/attach_pop.html">attach_pop</a></span><span class="op">(</span><span class="st">"1.2"</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">age</span><span class="op">~</span><span class="va">treatment</span>, data<span class="op">=</span><span class="va">data</span>, na.action <span class="op">=</span> <span class="va">na.omit</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regression_table.html">regression_table</a></span><span class="op">(</span><span class="va">fit</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean age reference arm"</span>,<span class="st">"Treament Effect"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#X &lt;- sumby(age, treatment, data=data, label="aGe (yAars)", text_clean = NULL)</span></span>
<span><span class="fu"><a href="../reference/write_table.html">write_table</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/attach_pop.html">attach_pop</a></span><span class="op">(</span><span class="st">"1.3"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">rx</span>, data<span class="op">=</span><span class="va">colon</span><span class="op">)</span></span>
<span><span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/km_ggplot.html">km_ggplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_plot.html">write_plot</a></span><span class="op">(</span><span class="va">fig</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/attach_pop.html">attach_pop</a></span><span class="op">(</span><span class="st">"2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_text.html">write_text</a></span><span class="op">(</span><span class="st">"There were no deaths"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-the-report">Creating the Report<a class="anchor" aria-label="anchor" href="#creating-the-report"></a>
</h3>
<p>Need to create names for the population labels, including the number
of subjects. Good to name the report ending with the suffix “.docx”.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">popn</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">popn</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"subjid"</span><span class="op">]</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">pop_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_meta_table.html">get_meta_table</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">population</span><span class="op">)</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">pop_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pop_size</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">popn_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="../reference/propercase.html">propercase</a></span><span class="op">(</span><span class="va">pop_name</span><span class="op">)</span>, <span class="st">" (n = "</span>, <span class="va">pop_size</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_meta_table.html">get_meta_table</a></span><span class="op">(</span><span class="op">)</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"Output"</span>, <span class="st">"meta_table.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code_tree.html">get_code_tree</a></span><span class="op">(</span><span class="op">)</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"Output"</span>, <span class="st">"codetree.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_docx.html">write_docx</a></span><span class="op">(</span></span>
<span>  report_title <span class="op">=</span> <span class="st">"Vignette Report"</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Simon Bond"</span>,</span>
<span>  filename <span class="op">=</span> <span class="st">"Vignette_Report.docx"</span>,<span class="co">#file.path("Output", "Reports", "Vignette_Report.docx"),</span></span>
<span>  popn_labels <span class="op">=</span> <span class="va">popn_labels</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; now dyn.load("/home/runner/work/_temp/Library/png/libs/png.so") ...</span></span>
<span><span class="co">#&gt; Vignette_Report.docx created.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                               sysname </span></span>
<span><span class="co">#&gt;                                               "Linux" </span></span>
<span><span class="co">#&gt;                                               release </span></span>
<span><span class="co">#&gt;                                   "6.11.0-1018-azure" </span></span>
<span><span class="co">#&gt;                                               version </span></span>
<span><span class="co">#&gt; "#18~24.04.1-Ubuntu SMP Sat Jun 28 04:46:03 UTC 2025" </span></span>
<span><span class="co">#&gt;                                              nodename </span></span>
<span><span class="co">#&gt;                                       "runnervmi13qx" </span></span>
<span><span class="co">#&gt;                                               machine </span></span>
<span><span class="co">#&gt;                                              "x86_64" </span></span>
<span><span class="co">#&gt;                                                 login </span></span>
<span><span class="co">#&gt;                                             "unknown" </span></span>
<span><span class="co">#&gt;                                                  user </span></span>
<span><span class="co">#&gt;                                              "runner" </span></span>
<span><span class="co">#&gt;                                        effective_user </span></span>
<span><span class="co">#&gt;                                              "runner"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] survival_3.8-3 xml2_1.5.1     rvest_1.0.5    tidyr_1.3.2    rmarkdown_2.30</span></span>
<span><span class="co">#&gt;  [6] readxl_1.4.5   magrittr_2.0.4 knitr_1.51     ggplot2_4.0.1  dplyr_1.1.4   </span></span>
<span><span class="co">#&gt; [11] cctu_0.8.11   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] sass_0.4.10        generics_0.1.4     lattice_0.22-7     digest_0.6.39     </span></span>
<span><span class="co">#&gt;  [5] evaluate_1.0.5     grid_4.5.2         RColorBrewer_1.1-3 fastmap_1.2.0     </span></span>
<span><span class="co">#&gt;  [9] cellranger_1.1.0   jsonlite_2.0.0     Matrix_1.7-4       gridExtra_2.3     </span></span>
<span><span class="co">#&gt; [13] httr_1.4.7         purrr_1.2.1        scales_1.4.0       textshaping_1.0.4 </span></span>
<span><span class="co">#&gt; [17] jquerylib_0.1.4    cli_3.6.5          rlang_1.1.7        splines_4.5.2     </span></span>
<span><span class="co">#&gt; [21] xslt_1.5.1         withr_3.0.2        cachem_1.1.0       yaml_2.3.12       </span></span>
<span><span class="co">#&gt; [25] tools_4.5.2        png_0.1-8          vctrs_0.6.5        R6_2.6.1          </span></span>
<span><span class="co">#&gt; [29] lifecycle_1.0.5    htmlwidgets_1.6.4  ragg_1.5.0         pkgconfig_2.0.3   </span></span>
<span><span class="co">#&gt; [33] pillar_1.11.1      bslib_0.9.0        gtable_0.3.6       data.table_1.18.0 </span></span>
<span><span class="co">#&gt; [37] glue_1.8.0         Rcpp_1.1.1         systemfonts_1.3.1  xfun_0.55         </span></span>
<span><span class="co">#&gt; [41] tibble_3.3.1       tidyselect_1.2.1   farver_2.1.2       htmltools_0.5.9   </span></span>
<span><span class="co">#&gt; [45] patchwork_1.3.2    labeling_0.4.3     compiler_4.5.2     S7_0.2.1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mon Jan 12 15:04:26 2026"</span></span></code></pre></div>
<p>The output is <a href="../doc/Vignette_Report_bak.docx">Vignette_Report_bak.docx</a>.</p>
<p>For the older function <code><a href="../reference/create_word_xml.html">create_word_xml()</a></code> output it was
neccesary to carry out post-processing in word. To permanently save,
first go to file &gt; Edit Links to Files; highlight all the figures
(shift + scroll), and click “break link”. Then File&gt; save as, and
ensure it is Saved As Type a “Word Document (*.docx)“.</p>
<p>This is not needed with <code>write_docx</code> output.</p>
</div>
<div class="section level3">
<h3 id="multiple-versions-of-reports">Multiple Versions of Reports<a class="anchor" aria-label="anchor" href="#multiple-versions-of-reports"></a>
</h3>
<p>Often you may need to produce slight variations on the same report,
such as a closed and open versions. We provide various options() to
overwrite the default arguments in <code>write_**()</code> with
<code>options(cctu_output="Other_Output_Folder")</code>, although you
would still need to create this directory and the required sub
directories first. Also you can provide
<code>source(file, local=TRUE)</code> to allow scripts to be run inside
a function, rather than in the global environment;
<code>options(cctu_source_local=TRUE)</code> overrides the default. But
then your code will need to branch to produce different outputs
(e.g. pooling arms or not), depending which version. You can select
subsets of the meta table to remove/include tables or figures in a
similar branching logic.</p>
<p>The idea is to be able to set some differing options and/or other R
objects in a single script that produces all versions of the report with
a repeated <code>source("main.R")</code>.</p>
<p>Alternative approaches have been found, code-to-write-code, using
<code><a href="https://rdrr.io/pkg/knitr/man/knit_expand.html" class="external-link">knitr::knit_expand</a></code>. Creating functions to modifying the
meta-table automatically. But not without complexity!</p>
<p>You will still need to produce the log of all the commands with
<code><a href="../reference/run_batch.html">run_batch()</a></code> or just
<code>system("R CMD BATCH main.R")</code> (N.B if you have extra
packages managed with <code>renv()</code> then you need to add a line
<code>renv::load()</code> at the start of your top-level script; don’t
use <code>--vanilla</code> as this stops the <code>renv</code> setup
working ). You still need to produce the output of cctu_env$code_tree
for all versions of the reports.</p>
<p>We’d recommend using a master script approach for simplicity and
readability, unless good reason not.</p>
</div>
<div class="section level3">
<h3 id="other-outputs">Other Outputs<a class="anchor" aria-label="anchor" href="#other-outputs"></a>
</h3>
<p>We can use rmarkdown to create other versions of the main report or a
graphical representation of the code architecture. You <em>may</em> need
to use
<code>Sys.setenv(RSTUDIO_PANDOC="C:/Program Files/RStudio/bin/pandoc")</code>
before calling <code>render</code>, but this is not understood by the
author at present as to why.</p>
<p>Numerous other outputs can be obtained from rmarkdown: slide show of
the figures, reformatting of output as desired…</p>
<div class="section level4">
<h4 id="code-tree">Code Tree<a class="anchor" aria-label="anchor" href="#code-tree"></a>
</h4>
<p>You can use the following example to produces a code tree pdf.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_code_tree.html">get_code_tree</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"codetree.pdf"</span>, width<span class="op">=</span><span class="fl">13</span>, height<span class="op">=</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ctfile</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You can also use <code>write_plot</code> function to include the code
tree plot in your report.</p>
</div>
<div class="section level4">
<h4 id="cross-reference-with-docx">Cross reference with Docx<a class="anchor" aria-label="anchor" href="#cross-reference-with-docx"></a>
</h4>
<p>Tables can be cross-referenced in the word. This is very convenient
if you are writing narratives and want to reference tables or figures.
You can find how to cross reference tables or figures <a href="https://erinwrightwriting.com/cross-reference-tables-and-figures-in-microsoft-word/" class="external-link">here</a>.
If you can changed the order of the tables by cut and paste or by
dragging the headings in the navigation pane of the word the reference
will still be there. You can press <code>Ctrl+A</code> select all, and
press <code>F9</code>. This will change numbering of the table and
figure, this change will also be applied to the references you made in
the narratives.</p>
</div>
<div class="section level4">
<h4 id="html-version-of-the-report">HTML version of the report<a class="anchor" aria-label="anchor" href="#html-version-of-the-report"></a>
</h4>
<p>Your readers may prefer to get the report in a HTML document to view
on-screen. This provides easier navigation with a floating toolbar. See
the vignette <code>Vignette Report HTML</code></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Bond, Alimu Dayimu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
