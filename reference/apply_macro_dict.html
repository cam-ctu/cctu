<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Apply DLU/CLU file to the data frame — apply_macro_dict • cctu</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Apply DLU/CLU file to the data frame — apply_macro_dict"><meta name="description" content="The variable label attribute will be applied to the data frame from the DLU
file."><meta property="og:description" content="The variable label attribute will be applied to the data frame from the DLU
file."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cctu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.8.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/analysis-template.html">Analysis Template</a></li>
    <li><a class="dropdown-item" href="../articles/using-cttab.html">Use cttab in the Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/rmarkdown_report.html">Generate HTML Report</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cam-ctu/cctu/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Apply DLU/CLU file to the data frame</h1>
      <small class="dont-index">Source: <a href="https://github.com/cam-ctu/cctu/blob/master/R/macro_utils.R" class="external-link"><code>R/macro_utils.R</code></a></small>
      <div class="d-none name"><code>apply_macro_dict.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The variable label attribute will be applied to the data frame from the DLU
file.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">apply_macro_dict</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">dlu</span>,</span>
<span>  clu <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  date_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"%d/%m/%Y"</span>, <span class="st">"%Y-%m-%d"</span>, <span class="st">"%Y/%m/%d"</span><span class="op">)</span>,</span>
<span>  clean_names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rm_empty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"cctu_rm_empty"</span>, default <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span>,</span>
<span>  check_catvar <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame to be applied.</p></dd>


<dt id="arg-dlu">dlu<a class="anchor" aria-label="anchor" href="#arg-dlu"></a></dt>
<dd><p>Data frame of DLU, see <code><a href="tidy_dlu.html">tidy_dlu</a></code> for the
requirements of DLU.</p></dd>


<dt id="arg-clu">clu<a class="anchor" aria-label="anchor" href="#arg-clu"></a></dt>
<dd><p>Data frame of CLU, see details for the requirements of CLU.</p></dd>


<dt id="arg-date-format">date_format<a class="anchor" aria-label="anchor" href="#arg-date-format"></a></dt>
<dd><p>Date format that will be tried by
<code><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></code>, default is <code>c("%d/%m/%Y",
"%Y-%m-%d", "%Y/%m/%d")</code>. You can add other formats you may want to try.
 The conversion will be skipped if the formatting does not succeed.</p></dd>


<dt id="arg-clean-names">clean_names<a class="anchor" aria-label="anchor" href="#arg-clean-names"></a></dt>
<dd><p>Convert variable name to lower case (default), this will
also change the values in the DLU as well. See <code><a href="clean_names.html">clean_names</a></code>
for details.</p></dd>


<dt id="arg-rm-empty">rm_empty<a class="anchor" aria-label="anchor" href="#arg-rm-empty"></a></dt>
<dd><p>Remove empty <code>"rows"</code>, <code>"cols"</code>, or
<code>"both"</code> (default),
 or not <code>"none"</code>. The <code><a href="remove_blank_rows_cols.html">remove_blank_rows_cols</a></code> function will
  be used to clean the empty rows and/or columns. If the data is large, this
   will take a long time, should be set to <code>"none"</code> in this case. Use
<code>options(cctu_rm_empty = "none")</code> to set global options.</p></dd>


<dt id="arg-check-catvar">check_catvar<a class="anchor" aria-label="anchor" href="#arg-check-catvar"></a></dt>
<dd><p>Check values of the category variable (defined in the
DLU file) contain any non-numeric values before converting variables to
numeric.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h3>


<p>This function first convert the data to a <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>.
This is to avoid the variable attributes dropped by base R functions. Then
 it will use the dlu file to convert the data into corresponding variable
 types. After the conversion of the data, variable and value label attribute
  will be created for the variable,
see <code><a href="var_lab.html">var_lab</a></code>) and <code><a href="val_lab.html">val_lab</a></code>.</p>
<p>User can use <code><a href="lab2val.html">lab2val</a></code> to conver value labels of the data to
values if the value label is desired. If the <code>clean_names</code> is set to
 <code>TRUE</code>, the data name and the dl/clu will be cleaned, including the
 question names in the dlu. The cleaned dlu data will be stored in the
 <code>cctu</code> environment. This will further be used by <code><a href="cttab.html">cttab</a></code>
to populate the missing report, see <code><a href="report_missing.html">report_missing</a></code>. You can
change this with <code><a href="set_dlu.html">set_dlu</a></code> function, but it will not have any
effect on this function, see <code><a href="set_dlu.html">set_dlu</a></code> more details.</p>
<p>Please use <code><a href="set_dlu.html">get_dlu</a></code> to get the dlu cleaned by
<code>apply_macro_dict</code> or use <code><a href="tidy_dlu.html">tidy_dlu</a></code> to clean it, which is
the same function used by <code>apply_macro_dict</code> to clean the DLU.</p>
</div>

<div class="section">
<h3 id="variable-conversion-based-on-dlu-type">Variable conversion based on DLU type<a class="anchor" aria-label="anchor" href="#variable-conversion-based-on-dlu-type"></a></h3>


<ul><li><p>IntegerData: Convert to numeric.</p></li>
<li><p>Real: Convert to numeric.</p></li>
<li><p>Category: If there are any non-numeric characters in the variable,
   no conversion  will be performed, otherwise convert to numeric.</p></li>
<li><p>Date: Convert data date format with <code><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></code>.
   The <code>date_format</code> will be used to feed the
   <code><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></code> function during the conversion.</p></li>
<li><p>Text: Convert to character.</p></li>
</ul></div>

<div class="section">
<h3 id="clu-data-requirements">CLU data requirements<a class="anchor" aria-label="anchor" href="#clu-data-requirements"></a></h3>


<p>The CLU file contains three columns:</p><ul><li><p>ShortCode: Variable name of the downloaded data.</p></li>
<li><p>CatCode: Category values, it represents the numeric code for an
   item in the CRF.</p></li>
<li><p>CatValue: Label of the category values, for example.</p></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="var_lab.html">var_lab</a></code> <code><a href="val_lab.html">val_lab</a></code> <code><a href="tidy_dlu.html">tidy_dlu</a></code>
<code><a href="set_dlu.html">set_dlu</a></code> <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>
<code><a href="clean_names.html">clean_names</a></code> <code><a href="read_data.html">read_data</a></code>
<code><a href="remove_blank_rows_cols.html">remove_blank_rows_cols</a></code> <code><a href="lab2val.html">lab2val</a></code>
 <code><a href="set_dlu.html">get_dlu</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read MACRO data</span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"pilotdata.csv"</span>, package<span class="op">=</span><span class="st">"cctu"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               colClasses <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dlu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"pilotdata_dlu.csv"</span>, package<span class="op">=</span><span class="st">"cctu"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">clu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"pilotdata_clu.csv"</span>, package<span class="op">=</span><span class="st">"cctu"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create subjid</span></span></span>
<span class="r-in"><span><span class="va">dt</span><span class="op">$</span><span class="va">subjid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">USUBJID</span>, <span class="fl">8</span>, <span class="fl">11</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">apply_macro_dict</span><span class="op">(</span><span class="va">dt</span>, dlu <span class="op">=</span> <span class="va">dlu</span>, clu <span class="op">=</span> <span class="va">clu</span>, clean_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Following can give you the same dlu file used by apply_macro_dict</span></span></span>
<span class="r-in"><span><span class="va">dlu</span> <span class="op">&lt;-</span> <span class="fu"><a href="tidy_dlu.html">tidy_dlu</a></span><span class="op">(</span><span class="va">dlu</span>, clean_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract data from Lab form</span></span></span>
<span class="r-in"><span><span class="va">lb</span> <span class="op">&lt;-</span> <span class="fu"><a href="extract_form.html">extract_form</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"Lab"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract screening visit data from lab form</span></span></span>
<span class="r-in"><span><span class="va">lb_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="extract_form.html">extract_form</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"Lab"</span>, visit <span class="op">=</span> <span class="st">"SCREENING"</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Bond, Alimu Dayimu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

